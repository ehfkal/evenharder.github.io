<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.17.2 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="ko" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>SCPC 2020 Round 2 후기 - ……!</title>
<meta name="description" content="SCPC 2020 2차 예선이 2020년 9월 5일에 진행되었습니다.">


  <meta name="author" content="Sangheon Lee">


<meta property="og:type" content="article">
<meta property="og:locale" content="ko_KR">
<meta property="og:site_name" content="......!">
<meta property="og:title" content="SCPC 2020 Round 2 후기">
<meta property="og:url" content="/algo/scpc-2020-round-2/">


  <meta property="og:description" content="SCPC 2020 2차 예선이 2020년 9월 5일에 진행되었습니다.">







  <meta property="article:published_time" content="2020-09-05T21:00:00+09:00">



  <meta property="article:modified_time" content="2020-09-05T21:00:00+09:00">




<link rel="canonical" href="/algo/scpc-2020-round-2/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": null,
      "url": "/"
    
  }
</script>






<!-- end _includes/seo.html -->


<meta name="google-site-verification" content="aZuP-wbEYrWwk4syUY5uvuLFUefbpUrcHT11l9_rEGc" />

<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="......! Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"/>
<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->




    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          ......!
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/posts/" >Posts</a>
            </li><li class="masthead__menu-item">
              <a href="/categories/" >Categories</a>
            </li><li class="masthead__menu-item">
              <a href="/tags/" >Tags</a>
            </li><li class="masthead__menu-item">
              <a href="/about/" >About</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">토글 메뉴</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      

      
        <img src="/assets/images/cheer_potato.png" alt="Sangheon Lee" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Sangheon Lee</h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>여기에 무얼 적으면 좋을까요?</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">팔로우</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Seoul, Korea</span>
        </li>
      

      
        
          
            <li><a href="mailto:comp.evenharder@gmail.com" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i> Email</a></li>
          
        
          
            <li><a href="https://github.com/evenharder" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
          
        
          
            <li><a href="https://www.acmicpc.net/user/evenharder" rel="nofollow noopener noreferrer"><i class="fas fa-link" aria-hidden="true"></i> BOJ</a></li>
          
        
          
            <li><a href="https://codeforces.com/profile/evenharder" rel="nofollow noopener noreferrer"><i class="fas fa-link" aria-hidden="true"></i> Codeforces</a></li>
          
        
          
            <li><a href="https://atcoder.jp/users/evenharder" rel="nofollow noopener noreferrer"><i class="fas fa-link" aria-hidden="true"></i> AtCoder</a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="SCPC 2020 Round 2 후기">
    <meta itemprop="description" content="SCPC 2020 2차 예선이 2020년 9월 5일에 진행되었습니다.">
    <meta itemprop="datePublished" content="September 05, 2020">
    <meta itemprop="dateModified" content="September 05, 2020">

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">SCPC 2020 Round 2 후기
</h1>
          
            <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  12 분 소요

</p>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right ">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-file-alt"></i> On This Page</h4></header>
              <ul class="toc__menu">
  <li><a href="#1-실력-맞추기">1. 실력 맞추기</a></li>
  <li><a href="#2-고구마">2. 고구마</a></li>
  <li><a href="#3-아르바이트">3. 아르바이트</a></li>
  <li><a href="#4-안전운전">4. 안전운전</a></li>
  <li><a href="#5-삼각형의-거리">5. 삼각형의 거리</a></li>
</ul>
            </nav>
          </aside>
        
        <p>SCPC 2020 2차 예선이 2020년 9월 5일에 진행되었습니다.</p>

<!--more-->

<p>이번 SCPC 2020 Round 2의 난이도 분포도 최근 대회와는 양상이 많이 달랐습니다. 보통 1번이나 2번에 가장 쉬운 문제가 있고 본선컷이 근접하게 120명 정도 만점자가 나오는 문제가 여럿 있었는데 이번에는 첫 두 문제가 비슷한 난이도로 제법 어렵게 등장하였으며, 3번부터는 더 어려워졌습니다. 첫 두 문제는 전형적인 문제에 제약조건이 추가된 형태로, 1번 문제 <strong>실력 맞추기</strong>는 정렬만 하는 문제에서 한 개의 쌍을 무시할 수 있는 문제로, 2번 문제 <strong>고구마</strong>는 maximum subarray problem에 최댓값이 추가되었습니다. 1차 예선 4번 문제와 비슷한 느낌을 주는 3번 문제 <strong>아르바이트</strong>는 시간 초과로 고통받기 쉬운 문제입니다. 4번 문제 <strong>안전운전</strong>은 2019년의 2차 예선 3번 문제 드론 탐험의 입력형식이 생각나는 문제입니다. 5번 문제 <strong>삼각형의 거리</strong>는 삼각화로 생성되는 듀얼 트리의 지름을 최소화하는 문제입니다.</p>

<p>용케도 2차 예선까지 만점을 받는데 성공했습니다. 개인적으로 5번 같은 유형에 약했는데 이번에 집중해볼 시간을 가질 수 있었습니다. 1번, 2번, 4번은 점심 전에 풀고, 돌아서 3번을 코딩한 다음에 좀 쉬다가 천천히 5번을 등반했습니다. 경험상 예선 점수와 본선 점수의 관계성이 그리 크진 않지만 개인적으로 뿌듯합니다. 전반적으로 구현이 좀 힘들었고, 3번부터의 난이도 때문에 본선컷은 어느 정도일지 가늠이 정말 안 됩니다…많은 분들이 참가할 수 있기를 희망합니다.</p>

<p><img src="/assets/images/scpc2020/r2.png" alt="" /></p>

<p>특이사항으로는 휴리스틱 문제가 전혀 나오지 않았습니다.</p>

<h1 id="1-실력-맞추기">1. 실력 맞추기</h1>

<p>길이 $N (\leq 200,000)$의 수열 ${a_i}$와 ${b_i}$가 있고, 수열 ${a_i}$의 값 중 하나를 바꿀 수 있을때, 이 수열을 재배열해서 $\sum_{i=1}^{N}\vert a_i - b_i \vert$를 최소화하는 문제입니다.</p>

<p>값을 바꿀 필요가 없다면 정렬한 다음에 비교하면 됩니다. 하지만 한 개의 값을 바꿀 수 있으므로 조금 더 생각을 해보아야 합니다. 차의 절댓값의 합을 최소화하려면 $a_i$을 적당한 $b_j$와 상쇄해야 하므로, 매칭이 원래는 $a_i \mapsto b_i$였다면 몇몇 연속된 구간은 $a_i \mapsto b_{i+1}$이나 $a_i \mapsto b_{i-1}$로 대응될 수 있습니다. 그러므로 $a_i \mapsto b_i$에 해당하는 매칭인 일반 누적합을 계산하고, $a_i \mapsto b_{i+1}$에 해당하는 누적합도 동적 계획법을 통해 계산할 수 있으며, 비슷하게 $a_i \mapsto b_{i-1}$에 해당하는 누적합도 계산할 수 있습니다. 역방향으로 오는 누적합도 비슷하게 계산해줄 수 있습니다.</p>

<p>총 시간 복잡도는 테스트 케이스 당 $\mathcal{O} (N \lg N)$입니다. 코드는 다음과 같습니다.</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;bits/stdc++.h&gt;
</span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="k">using</span> <span class="n">ll</span> <span class="o">=</span> <span class="kt">long</span> <span class="kt">long</span><span class="p">;</span>
<span class="k">using</span> <span class="n">pii</span> <span class="o">=</span> <span class="n">pair</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">lim</span> <span class="o">=</span> <span class="mf">2e5</span><span class="o">+</span><span class="mi">2</span><span class="p">;</span>
<span class="n">ll</span> <span class="n">s</span><span class="p">[</span><span class="n">lim</span><span class="p">],</span> <span class="n">rs</span><span class="p">[</span><span class="n">lim</span><span class="p">],</span> <span class="n">d</span><span class="p">[</span><span class="n">lim</span><span class="p">],</span> <span class="n">rd</span><span class="p">[</span><span class="n">lim</span><span class="p">],</span> <span class="n">u</span><span class="p">[</span><span class="n">lim</span><span class="p">],</span> <span class="n">ru</span><span class="p">[</span><span class="n">lim</span><span class="p">];</span>
<span class="n">ll</span> <span class="n">a</span><span class="p">[</span><span class="n">lim</span><span class="p">],</span> <span class="n">b</span><span class="p">[</span><span class="n">lim</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">tt</span><span class="p">;</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">ios_base</span><span class="o">::</span><span class="n">sync_with_stdio</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
    <span class="n">cin</span><span class="p">.</span><span class="n">tie</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>

    <span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">tt</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">t</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">t</span><span class="o">&lt;=</span><span class="n">tt</span><span class="p">;</span><span class="n">t</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">n</span><span class="p">;</span>
        <span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">n</span><span class="p">;</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
            <span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
            <span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="n">sort</span><span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">a</span><span class="o">+</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
        <span class="n">sort</span><span class="p">(</span><span class="n">b</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="o">+</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
        <span class="n">rs</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">rd</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">ru</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>   <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">abs</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="p">;</span><span class="n">i</span><span class="o">--</span><span class="p">)</span>      <span class="n">rs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">rs</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">abs</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>   <span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span> <span class="o">+</span> <span class="n">abs</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="p">;</span><span class="n">i</span><span class="o">--</span><span class="p">)</span>    <span class="n">rd</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">rd</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">rs</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">])</span> <span class="o">+</span> <span class="n">abs</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>   <span class="n">u</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span> <span class="o">+</span> <span class="n">abs</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]);</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="p">;</span><span class="n">i</span><span class="o">--</span><span class="p">)</span>    <span class="n">ru</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">ru</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">rs</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">])</span> <span class="o">+</span> <span class="n">abs</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]);</span>
        <span class="n">ll</span> <span class="n">ans</span> <span class="o">=</span> <span class="mi">1LL</span> <span class="o">*</span> <span class="n">n</span> <span class="o">*</span> <span class="mf">1e9</span><span class="p">;</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
            <span class="n">ans</span> <span class="o">=</span> <span class="n">min</span><span class="p">({</span><span class="n">ans</span><span class="p">,</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">rs</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">ru</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">rd</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">u</span><span class="p">[</span><span class="n">i</span><span class="p">]});</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Case #"</span> <span class="o">&lt;&lt;</span> <span class="n">t</span> <span class="o">&lt;&lt;</span> <span class="sc">'\n'</span> <span class="o">&lt;&lt;</span> <span class="n">ans</span> <span class="o">&lt;&lt;</span> <span class="sc">'\n'</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h1 id="2-고구마">2. 고구마</h1>

<p>길이 $n (\leq 300,000)$의 수열이 있습니다. 합이 $M$ 이하인 연속 구간 중 가장 합이 클 때의 값을 구하면 됩니다.</p>

<p>합의 상한이 없다면 Kadane’s Algorithm을 통해 $\mathcal{O}(N)$에 구할 수 있습니다. 하지만 이 알고리즘에 상한만을 적용해서는 풀 수 없을 것이라 생각됩니다. 그럼 prefix sum을 계산하여 각 prefix sum마다 이분 탐색을 하는 건 어떨까요? 값이 전부 음수일 때만 넣어봐도 올바른 접근이 아님을 알 수 있습니다.</p>

<p>하지만 prefix sum을 쓰는 전략은 유효합니다. multiset(중복된 값을 포함하는 balanced binary search tree)에 prefix sum을 넣고, 등장 순서에 따라 개별적으로 이분탐색을 한 다음 multiset에서 prefix sum을 빼면 됩니다. $[1, i]$에 해당하는 prefix sum을 선택했으면, $j \geq i$이면서 조건을 만족하는 $[1, j]$를 검색하는 과정이라 생각하면 됩니다.</p>

<p>multiset은 좀 무거운 STL 중 하나지만, 시간 제한 안에 돌기에는 충분했습니다. 시간 복잡도는 $\mathcal{O}(N \lg N)$입니다. 코드는 다음과 같습니다.</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;bits/stdc++.h&gt;
</span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="k">using</span> <span class="n">ll</span> <span class="o">=</span> <span class="kt">long</span> <span class="kt">long</span><span class="p">;</span>
<span class="k">using</span> <span class="n">pii</span> <span class="o">=</span> <span class="n">pair</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">lim</span> <span class="o">=</span> <span class="mf">3e5</span><span class="o">+</span><span class="mi">2</span><span class="p">;</span>
<span class="n">ll</span> <span class="n">s</span><span class="p">[</span><span class="n">lim</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">tt</span><span class="p">;</span>
<span class="n">multiset</span><span class="o">&lt;</span><span class="n">ll</span><span class="o">&gt;</span> <span class="n">ms</span><span class="p">;</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">ios_base</span><span class="o">::</span><span class="n">sync_with_stdio</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
    <span class="n">cin</span><span class="p">.</span><span class="n">tie</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>

    <span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">tt</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">t</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">t</span><span class="o">&lt;=</span><span class="n">tt</span><span class="p">;</span><span class="n">t</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">n</span><span class="p">;</span>
        <span class="n">ll</span> <span class="n">m</span><span class="p">;</span>
        <span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">n</span> <span class="o">&gt;&gt;</span> <span class="n">m</span><span class="p">;</span>
        <span class="n">ms</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
        <span class="n">ms</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">ll</span> <span class="n">a</span><span class="p">;</span>
            <span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">a</span><span class="p">;</span>
            <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">];</span>
            <span class="n">ms</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
        <span class="p">}</span>
        <span class="n">ll</span> <span class="n">ans</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">auto</span> <span class="n">it</span> <span class="o">=</span> <span class="n">ms</span><span class="p">.</span><span class="n">upper_bound</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">m</span><span class="p">);</span>
            <span class="k">if</span><span class="p">(</span><span class="n">it</span> <span class="o">!=</span> <span class="n">ms</span><span class="p">.</span><span class="n">begin</span><span class="p">())</span> <span class="n">it</span><span class="o">--</span><span class="p">;</span>
            <span class="n">ans</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span><span class="n">ans</span><span class="p">,</span> <span class="o">*</span><span class="n">it</span> <span class="o">-</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
            <span class="n">ms</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="n">ms</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]));</span>
        <span class="p">}</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Case #"</span> <span class="o">&lt;&lt;</span> <span class="n">t</span> <span class="o">&lt;&lt;</span> <span class="sc">'\n'</span> <span class="o">&lt;&lt;</span> <span class="n">ans</span> <span class="o">&lt;&lt;</span> <span class="sc">'\n'</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h1 id="3-아르바이트">3. 아르바이트</h1>

<p>$1$ 이상 $10^5$ 이하의 정수로만 이루어진 길이 $N (\leq 200,000)$의 수열이 있습니다. 연속된 $K(\leq min(200, N))$개의 수의 합의 중앙값을 구하고자 합니다. 수는 최대 $Q(\leq 10^3)$번 갱신될 수 있고, 갱신될 때도 중앙값을 구해야 합니다.</p>

<p>처음에는 버킷으로 쪼개서 IOI’11 Elephants처럼 푸는 방법을 생각해보았으나 수가 너무 자주 갱신되어서 다르게 생각해보았습니다. 우선 중앙값이 될 수 있는 수들의 범위는 약 $KN$ 이하의 양의 정수입니다. 중앙값은 펜윅 트리에서 k번째 원소를 구하는 방법을 이용하면 쉽게 구할 수 있습니다. 문제는 $KN \approx 2 \times 10^7$이므로 하나의 펜윅 트리에 넣기에는 좀 부담스럽다는 점이 남습니다.</p>

<p>때문에, 펜윅트리를 버킷마냥 여러 개로 쪼개서 관리하면 로그항의 시간복잡도도 낮출 수 있을 뿐더러 cache miss도 덜 납니다. 저는 $2^{14}$ 단위로 끊어서 관리했습니다. 이러면 수의 갱신은 $\mathcal{O}(\lg 2^{14})$, 중앙값 계산은 $\mathcal{O}(\frac{KN}{2^{14}} + \lg 2^{14})$ 정도에 진행할 수 있어 총 시간 복잡도는 $\mathcal{O}(Q(K \lg 2^{14} + \frac{KN}{2^{14}}))$, 공간 복잡도는 $\mathcal{O}(KN)$이 됩니다. 2초 이내에 돌았던 것으로 기억합니다.</p>

<p>1차 예선 4번 문제처럼 좌표압축을 시도하면 구현에 따라 상당한 상수 커팅이 필요하다고 들었습니다. <a href="http://www.secmem.org/blog/2020/08/16/heap/">priority_queue에 커팅을 넣은 자료구조</a>를 사용하여 만점을 받았다는 분들도 있었습니다. 저도 반신반의하면서 2천만 크기의 펜윅 트리를 잡았기에, 이 방법을 알고는 있었지만 ‘이게 시간 안에 돌아?’라고 의구심을 가진 분들이 적지 않아보였습니다.</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;bits/stdc++.h&gt;
</span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="k">using</span> <span class="n">ll</span> <span class="o">=</span> <span class="kt">long</span> <span class="kt">long</span><span class="p">;</span>
<span class="k">using</span> <span class="n">pii</span> <span class="o">=</span> <span class="n">pair</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">14</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">blen</span> <span class="o">=</span> <span class="mi">1225</span><span class="p">;</span>
<span class="k">struct</span> <span class="nc">bitree</span><span class="p">{</span>
    <span class="kt">int</span> <span class="n">a</span><span class="p">[(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="mi">14</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">];</span>
    <span class="k">const</span> <span class="kt">int</span> <span class="n">sz</span> <span class="o">=</span> <span class="mi">1</span><span class="o">&lt;&lt;</span><span class="mi">14</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">tot</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">void</span> <span class="n">update</span><span class="p">(</span><span class="kt">int</span> <span class="n">pos</span><span class="p">,</span> <span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">tot</span> <span class="o">+=</span> <span class="n">x</span><span class="p">;</span>
        <span class="k">while</span><span class="p">(</span><span class="n">pos</span> <span class="o">&lt;=</span> <span class="n">sz</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">a</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="o">+=</span> <span class="n">x</span><span class="p">;</span>
            <span class="n">pos</span> <span class="o">+=</span> <span class="p">(</span><span class="n">pos</span> <span class="o">&amp;</span> <span class="o">-</span><span class="n">pos</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="kt">int</span> <span class="n">kth</span><span class="p">(</span><span class="kt">int</span> <span class="n">k</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">tot</span> <span class="o">&lt;</span> <span class="n">k</span><span class="p">)</span> <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="n">sz</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="p">;</span><span class="n">i</span><span class="o">&gt;&gt;=</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">pos</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">k</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">pos</span> <span class="o">+=</span> <span class="n">i</span><span class="p">;</span>
                <span class="n">k</span> <span class="o">-=</span> <span class="n">a</span><span class="p">[</span><span class="n">pos</span><span class="p">];</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">pos</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span> <span class="n">bit</span><span class="p">[</span><span class="n">blen</span><span class="p">];</span>
<span class="kt">int</span> <span class="nf">find_kth</span><span class="p">(</span><span class="kt">int</span> <span class="n">k</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">blen</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">res</span> <span class="o">=</span> <span class="n">bit</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">kth</span><span class="p">(</span><span class="n">k</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">res</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="n">k</span> <span class="o">-=</span> <span class="n">bit</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">tot</span><span class="p">;</span>
        <span class="k">else</span> <span class="k">return</span> <span class="p">(</span><span class="n">res</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="mi">14</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="nf">bit_update</span><span class="p">(</span><span class="kt">int</span> <span class="n">pos</span><span class="p">,</span> <span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">bit</span><span class="p">[</span><span class="n">pos</span> <span class="o">&gt;&gt;</span> <span class="mi">14</span><span class="p">].</span><span class="n">update</span><span class="p">((</span><span class="n">pos</span> <span class="o">&amp;</span> <span class="n">mask</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="n">a</span><span class="p">[</span><span class="mi">200002</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">s</span><span class="p">[</span><span class="mi">200002</span><span class="p">];</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">ios_base</span><span class="o">::</span><span class="n">sync_with_stdio</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
    <span class="n">cin</span><span class="p">.</span><span class="n">tie</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">tt</span><span class="p">;</span>
    <span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">tt</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">t</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">t</span><span class="o">&lt;=</span><span class="n">tt</span><span class="p">;</span><span class="n">t</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">q</span><span class="p">;</span>
        <span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">n</span> <span class="o">&gt;&gt;</span> <span class="n">k</span> <span class="o">&gt;&gt;</span> <span class="n">q</span><span class="p">;</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
            <span class="k">if</span><span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">k</span><span class="p">)</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
            <span class="k">else</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="n">k</span><span class="p">];</span>
        <span class="p">}</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">n</span><span class="o">-</span><span class="n">k</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">bit_update</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">1</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Case #"</span> <span class="o">&lt;&lt;</span> <span class="n">t</span> <span class="o">&lt;&lt;</span> <span class="sc">'\n'</span><span class="p">;</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">find_kth</span><span class="p">((</span><span class="n">n</span><span class="o">-</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">q</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="kt">int</span> <span class="n">pos</span><span class="p">,</span> <span class="n">val</span><span class="p">;</span>
            <span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">pos</span> <span class="o">&gt;&gt;</span> <span class="n">val</span><span class="p">;</span>
            <span class="n">pos</span><span class="o">--</span><span class="p">;</span>
            <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="n">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">pos</span><span class="o">-</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span><span class="n">j</span><span class="o">&lt;=</span><span class="n">min</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="n">k</span><span class="p">,</span> <span class="n">pos</span><span class="p">);</span><span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">bit_update</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>
                <span class="n">s</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="n">val</span> <span class="o">-</span> <span class="n">a</span><span class="p">[</span><span class="n">pos</span><span class="p">];</span>
                <span class="n">bit_update</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="mi">1</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="n">a</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span><span class="p">;</span>
            <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="sc">' '</span> <span class="o">&lt;&lt;</span> <span class="n">find_kth</span><span class="p">((</span><span class="n">n</span><span class="o">-</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="sc">'\n'</span><span class="p">;</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">n</span><span class="o">-</span><span class="n">k</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">bit_update</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>
            <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h1 id="4-안전운전">4. 안전운전</h1>

<p>가로선과 세로선으로 이루어진 경계가 좌우로 있고, 역시 가로선과 세로선으로 구성된 ‘경로’가 있습니다. 경계와 경로는 $y = 0$에서 시작하며 $y$좌표가 감소하지 않습니다.</p>

<p>경로의 가로선에 있는 점을 지나는 세로축을 중심으로 그 점의 $y$좌표 이상의 경로를 대칭시킬 수 있습니다. 경계 사이에 있는 세로선의 길이를 최대화하고자 하는 문제입니다. 대칭 과정은 최대 1번만 할 수 있습니다. 각 경로와 경계의 세로선의 개수는 $200,000$개 이하입니다.</p>

<p>경계나 경로의 $x$좌표가 바뀔 때마다 경로의 세로선을 조금 잘게 쪼개어볼 수 있습니다. 이러면  쪼개진 각 경로는 한 묶음으로 생각할 수 있고, 쪼개진 경로마다 대칭되어도 구간 안에 들어올 수 있는 $x$좌표 구간 또한 계산할 수 있습니다.</p>

<p>이 $x$좌표의 개수가 약 $10^6$개 정도 있으므로 좌표압축을 통해 값을 압축하고, 세그먼트 트리를 통해 위쪽의 쪼개진 경로부터 ‘이 $x$좌표를 선택하면 이 선분의 길이만큼을 얻을 수 있다’를 갱신해나가고 가로선을 만나면 해당 구간의 최댓값을 조사하면 됩니다. 구간합 갱신 / 구간최대 질의가 가능한 세그먼트 트리를 사용하면 됩니다. 별개로, 밑에서 해당 구간까지 뒤집어지진 않았지만 구간 안에 있는 세로선의 길이도 계산해야 합니다.</p>

<p>세로선을 쪼개는 건 작년 2차 예선 3번과 비슷한 느낌이었습니다. 시간 복잡도는 $\mathcal{O}(N \lg N)$이며, 원소 개수를 어림짐작해 $2^{20}$로 생각했는데 다행히 그 안에 들어오는 모양입니다 (90만 개 정도라고 합니다).</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;bits/stdc++.h&gt;
</span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="k">using</span> <span class="n">ll</span> <span class="o">=</span> <span class="kt">long</span> <span class="kt">long</span><span class="p">;</span>
<span class="k">using</span> <span class="n">pii</span> <span class="o">=</span> <span class="n">pair</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span><span class="p">;</span>
<span class="k">struct</span> <span class="nc">wall</span><span class="p">{</span>
    <span class="kt">int</span> <span class="n">h</span><span class="p">,</span> <span class="n">x</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">struct</span> <span class="nc">seg</span><span class="p">{</span>
    <span class="kt">int</span> <span class="n">h</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">x</span><span class="p">;</span>
<span class="p">};</span>
<span class="n">vector</span><span class="o">&lt;</span><span class="n">wall</span><span class="o">&gt;</span> <span class="n">vl</span><span class="p">,</span> <span class="n">vr</span><span class="p">,</span> <span class="n">vc</span><span class="p">;</span>
<span class="n">vector</span><span class="o">&lt;</span><span class="n">seg</span><span class="o">&gt;</span> <span class="n">v</span><span class="p">;</span>
<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">vx</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">done</span><span class="p">[</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="mi">20</span><span class="p">];</span>
<span class="kt">void</span> <span class="nf">wall_input</span><span class="p">(</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">wall</span><span class="o">&gt;&amp;</span> <span class="n">vw</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">d</span><span class="p">,</span> <span class="n">h</span><span class="p">;</span>
        <span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">d</span> <span class="o">&gt;&gt;</span> <span class="n">h</span><span class="p">;</span>
        <span class="n">x</span> <span class="o">+=</span> <span class="n">d</span><span class="p">;</span>
        <span class="n">vw</span><span class="p">.</span><span class="n">push_back</span><span class="p">({</span><span class="n">h</span><span class="p">,</span> <span class="n">x</span><span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="k">struct</span> <span class="nc">segtree</span><span class="p">{</span>
    <span class="c1">// range add update, range max query</span>
    <span class="kt">int</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="mi">21</span><span class="p">],</span> <span class="n">lz</span><span class="p">[</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="mi">21</span><span class="p">],</span> <span class="n">sz</span><span class="p">;</span>
    <span class="kt">void</span> <span class="n">init</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span><span class="p">(</span><span class="n">sz</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">sz</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="n">sz</span><span class="o">&lt;&lt;=</span><span class="mi">1</span><span class="p">);</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">*</span><span class="n">sz</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
            <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">lz</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kt">void</span> <span class="n">update_lazy</span><span class="p">(</span><span class="kt">int</span> <span class="n">l</span><span class="p">,</span> <span class="kt">int</span> <span class="n">r</span><span class="p">,</span> <span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">a</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">+=</span> <span class="n">lz</span><span class="p">[</span><span class="n">x</span><span class="p">];</span>
        <span class="k">if</span><span class="p">(</span><span class="n">l</span> <span class="o">!=</span> <span class="n">r</span><span class="p">)</span> <span class="n">lz</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">x</span><span class="p">]</span> <span class="o">+=</span> <span class="n">lz</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="n">lz</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">lz</span><span class="p">[</span><span class="n">x</span><span class="p">];</span>
        <span class="n">lz</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kt">void</span> <span class="n">update</span><span class="p">(</span><span class="kt">int</span> <span class="n">s</span><span class="p">,</span> <span class="kt">int</span> <span class="n">e</span><span class="p">,</span> <span class="kt">int</span> <span class="n">l</span><span class="p">,</span> <span class="kt">int</span> <span class="n">r</span><span class="p">,</span> <span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">val</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">update_lazy</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">x</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">s</span> <span class="o">&lt;=</span> <span class="n">l</span> <span class="o">&amp;&amp;</span> <span class="n">r</span> <span class="o">&lt;=</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">lz</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">+=</span> <span class="n">val</span><span class="p">;</span>
            <span class="n">update_lazy</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">x</span><span class="p">);</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span><span class="p">(</span><span class="n">e</span> <span class="o">&lt;</span> <span class="n">l</span> <span class="o">||</span> <span class="n">r</span> <span class="o">&lt;</span> <span class="n">s</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
        <span class="n">update</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="n">r</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">x</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>
        <span class="n">update</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="n">r</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>
        <span class="n">a</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">x</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">]);</span>
    <span class="p">}</span>
    <span class="kt">void</span> <span class="n">update</span><span class="p">(</span><span class="kt">int</span> <span class="n">s</span><span class="p">,</span> <span class="kt">int</span> <span class="n">e</span><span class="p">,</span> <span class="kt">int</span> <span class="n">val</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">update</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">sz</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="kt">int</span> <span class="n">query</span><span class="p">(</span><span class="kt">int</span> <span class="n">s</span><span class="p">,</span> <span class="kt">int</span> <span class="n">e</span><span class="p">,</span> <span class="kt">int</span> <span class="n">l</span><span class="p">,</span> <span class="kt">int</span> <span class="n">r</span><span class="p">,</span> <span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">update_lazy</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">x</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">s</span> <span class="o">&lt;=</span> <span class="n">l</span> <span class="o">&amp;&amp;</span> <span class="n">r</span> <span class="o">&lt;=</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="n">a</span><span class="p">[</span><span class="n">x</span><span class="p">];</span>
        <span class="p">}</span>
        <span class="k">if</span><span class="p">(</span><span class="n">e</span> <span class="o">&lt;</span> <span class="n">l</span> <span class="o">||</span> <span class="n">r</span> <span class="o">&lt;</span> <span class="n">s</span><span class="p">)</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">return</span> <span class="n">max</span><span class="p">(</span><span class="n">query</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="n">r</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">x</span><span class="p">),</span> <span class="n">query</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="n">r</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">));</span>
    <span class="p">}</span>
    <span class="kt">int</span> <span class="n">query</span><span class="p">(</span><span class="kt">int</span> <span class="n">s</span><span class="p">,</span> <span class="kt">int</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">query</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">sz</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span> <span class="n">segtr</span><span class="p">;</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">ios_base</span><span class="o">::</span><span class="n">sync_with_stdio</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
    <span class="n">cin</span><span class="p">.</span><span class="n">tie</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">tt</span><span class="p">;</span>
    <span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">tt</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">l</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">t</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">t</span><span class="o">&lt;=</span><span class="n">tt</span><span class="p">;</span><span class="n">t</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">vl</span><span class="p">.</span><span class="n">clear</span><span class="p">(),</span> <span class="n">vr</span><span class="p">.</span><span class="n">clear</span><span class="p">(),</span> <span class="n">vc</span><span class="p">.</span><span class="n">clear</span><span class="p">(),</span> <span class="n">v</span><span class="p">.</span><span class="n">clear</span><span class="p">(),</span> <span class="n">vx</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
        <span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">l</span> <span class="o">&gt;&gt;</span> <span class="n">m</span> <span class="o">&gt;&gt;</span> <span class="n">n</span><span class="p">;</span>
        <span class="n">wall_input</span><span class="p">(</span><span class="n">vl</span><span class="p">,</span> <span class="n">l</span><span class="p">);</span>
        <span class="n">wall_input</span><span class="p">(</span><span class="n">vr</span><span class="p">,</span> <span class="n">m</span><span class="p">);</span>
        <span class="n">wall_input</span><span class="p">(</span><span class="n">vc</span><span class="p">,</span> <span class="n">n</span><span class="p">);</span>

        <span class="kt">int</span> <span class="n">ans</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">lpos</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">rpos</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">cpos</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">lh</span> <span class="o">=</span> <span class="n">vl</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">h</span><span class="p">,</span> <span class="n">rh</span> <span class="o">=</span> <span class="n">vr</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">h</span><span class="p">,</span> <span class="n">ch</span> <span class="o">=</span> <span class="n">vc</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">h</span><span class="p">;</span>
        <span class="k">while</span><span class="p">(</span><span class="n">lpos</span> <span class="o">&lt;</span> <span class="n">l</span> <span class="o">&amp;&amp;</span> <span class="n">rpos</span> <span class="o">&lt;</span> <span class="n">m</span> <span class="o">&amp;&amp;</span> <span class="n">cpos</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">)</span> <span class="p">{</span>
            <span class="kt">int</span> <span class="n">nh</span> <span class="o">=</span> <span class="n">min</span><span class="p">({</span><span class="n">lh</span><span class="p">,</span> <span class="n">rh</span><span class="p">,</span> <span class="n">ch</span><span class="p">});</span>
            <span class="k">if</span><span class="p">(</span><span class="n">vl</span><span class="p">[</span><span class="n">lpos</span><span class="p">].</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="n">vc</span><span class="p">[</span><span class="n">cpos</span><span class="p">].</span><span class="n">x</span> <span class="o">&amp;&amp;</span> <span class="n">vc</span><span class="p">[</span><span class="n">cpos</span><span class="p">].</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="n">vr</span><span class="p">[</span><span class="n">rpos</span><span class="p">].</span><span class="n">x</span><span class="p">)</span>
                <span class="n">ans</span> <span class="o">+=</span> <span class="n">nh</span><span class="p">;</span>
            <span class="n">done</span><span class="p">[</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">()]</span> <span class="o">=</span> <span class="n">ans</span><span class="p">;</span>
            <span class="n">v</span><span class="p">.</span><span class="n">push_back</span><span class="p">({</span><span class="n">nh</span><span class="p">,</span> <span class="p">(</span><span class="n">vc</span><span class="p">[</span><span class="n">cpos</span><span class="p">].</span><span class="n">x</span> <span class="o">+</span> <span class="n">vl</span><span class="p">[</span><span class="n">lpos</span><span class="p">].</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">vc</span><span class="p">[</span><span class="n">cpos</span><span class="p">].</span><span class="n">x</span> <span class="o">+</span> <span class="n">vr</span><span class="p">[</span><span class="n">rpos</span><span class="p">].</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">vc</span><span class="p">[</span><span class="n">cpos</span><span class="p">].</span><span class="n">x</span><span class="p">});</span>
            <span class="n">lh</span> <span class="o">-=</span> <span class="n">nh</span><span class="p">,</span> <span class="n">rh</span> <span class="o">-=</span> <span class="n">nh</span><span class="p">,</span> <span class="n">ch</span> <span class="o">-=</span> <span class="n">nh</span><span class="p">;</span>
            <span class="k">if</span><span class="p">(</span><span class="n">lh</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">lpos</span><span class="o">++</span><span class="p">;</span>
                <span class="k">if</span><span class="p">(</span><span class="n">lpos</span> <span class="o">!=</span> <span class="n">l</span><span class="p">)</span> <span class="n">lh</span> <span class="o">=</span> <span class="n">vl</span><span class="p">[</span><span class="n">lpos</span><span class="p">].</span><span class="n">h</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">if</span><span class="p">(</span><span class="n">rh</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">rpos</span><span class="o">++</span><span class="p">;</span>
                <span class="k">if</span><span class="p">(</span><span class="n">rpos</span> <span class="o">!=</span> <span class="n">m</span><span class="p">)</span> <span class="n">rh</span> <span class="o">=</span> <span class="n">vr</span><span class="p">[</span><span class="n">rpos</span><span class="p">].</span><span class="n">h</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">if</span><span class="p">(</span><span class="n">ch</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">cpos</span><span class="o">++</span><span class="p">;</span>
                <span class="k">if</span><span class="p">(</span><span class="n">cpos</span> <span class="o">!=</span> <span class="n">n</span><span class="p">)</span> <span class="n">ch</span> <span class="o">=</span> <span class="n">vc</span><span class="p">[</span><span class="n">cpos</span><span class="p">].</span><span class="n">h</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">for</span><span class="p">(</span><span class="n">seg</span><span class="o">&amp;</span> <span class="n">s</span> <span class="o">:</span> <span class="n">v</span><span class="p">)</span>
            <span class="n">vx</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">l</span><span class="p">),</span> <span class="n">vx</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">r</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">vx</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">x</span><span class="p">);</span>
        <span class="n">sort</span><span class="p">(</span><span class="n">vx</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">vx</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
        <span class="n">vx</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">unique</span><span class="p">(</span><span class="n">vx</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">vx</span><span class="p">.</span><span class="n">end</span><span class="p">())</span> <span class="o">-</span> <span class="n">vx</span><span class="p">.</span><span class="n">begin</span><span class="p">());</span>
        <span class="k">for</span><span class="p">(</span><span class="n">seg</span><span class="o">&amp;</span> <span class="n">s</span> <span class="o">:</span> <span class="n">v</span><span class="p">)</span>
            <span class="n">s</span><span class="p">.</span><span class="n">l</span> <span class="o">=</span> <span class="n">lower_bound</span><span class="p">(</span><span class="n">vx</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">vx</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">s</span><span class="p">.</span><span class="n">l</span><span class="p">)</span> <span class="o">-</span> <span class="n">vx</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span>
            <span class="n">s</span><span class="p">.</span><span class="n">r</span> <span class="o">=</span> <span class="n">lower_bound</span><span class="p">(</span><span class="n">vx</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">vx</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">s</span><span class="p">.</span><span class="n">r</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">vx</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span>
            <span class="n">s</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">lower_bound</span><span class="p">(</span><span class="n">vx</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">vx</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">s</span><span class="p">.</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">vx</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>
        <span class="n">segtr</span><span class="p">.</span><span class="n">init</span><span class="p">(</span><span class="n">vx</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>

        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">const</span> <span class="n">seg</span><span class="o">&amp;</span> <span class="n">s</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
            <span class="n">segtr</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">l</span><span class="p">,</span> <span class="n">s</span><span class="p">.</span><span class="n">r</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">s</span><span class="p">.</span><span class="n">h</span><span class="p">);</span>
            <span class="k">if</span><span class="p">(</span><span class="n">i</span> <span class="o">&amp;&amp;</span> <span class="n">s</span><span class="p">.</span><span class="n">x</span> <span class="o">!=</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">].</span><span class="n">x</span><span class="p">)</span> <span class="p">{</span>
                <span class="kt">int</span> <span class="n">qu</span> <span class="o">=</span> <span class="n">segtr</span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="n">min</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">].</span><span class="n">x</span><span class="p">),</span> <span class="n">max</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">].</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
                <span class="n">ans</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span><span class="n">ans</span><span class="p">,</span> <span class="n">qu</span><span class="o">+</span><span class="n">done</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]);</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Case #"</span> <span class="o">&lt;&lt;</span> <span class="n">t</span> <span class="o">&lt;&lt;</span> <span class="sc">'\n'</span> <span class="o">&lt;&lt;</span> <span class="n">ans</span> <span class="o">&lt;&lt;</span> <span class="sc">'\n'</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h1 id="5-삼각형의-거리">5. 삼각형의 거리</h1>

<p>$n(\leq 300)$각형의 삼각 분할로 생성될 수 있는 듀얼 트리의 최소 지름을 구하는 문제입니다. 몰랐는데 서브태스크 1은 작년 서울 리저널 기출이라고 합니다 (본선 <a href="https://www.acmicpc.net/problem/17977">J번 - Triangulation</a>).</p>

<p>얼핏 봐도 선분 교차 여부나, 선분이 다각형 내부로 향하는지를 판별해야 합니다. 다행히 세 점이 한 직선을 지나는 경우가 없기 때문에 벡터의 외적을 이용하면 어렵지 않게 구현할 수 있으나 후자는 처음 구현해봐서 실수가 많이 났습니다. 각각 코드의 <code class="language-plaintext highlighter-rouge">seg_cross</code> 함수와 <code class="language-plaintext highlighter-rouge">right_dir</code> 함수로 구현되어 있습니다.</p>

<p>번거로운 기하 구현을 해내면 까다로운 동적 계획법 아이디어를 내야 합니다. 얼핏 생각하면 ‘$i$번째 점부터 $j$번째 점까지로 구성된 단순 다각형에서 지름/반지름이 최소로 되는 값’을 dp로 저장하며 할 수 있어 보이지만, 두 상태가 같지 않을 수 있기 때문에 다른 접근이 필요합니다.</p>

<p>문제를 ‘지름이 $d$ 이하인 삼각 분할 트리를 만들 수 있는가?’로 바꾸어봅시다. 그러면 $f(i, j)$를 $i$번째 점부터 $j$번째 점까지 이루어진 단순다각형 $P_{ij}$에서, 선분 $i - j$를 포함하는 삼각형 $t$를 만들어 $t$에서 가장 멀리 떨어진 삼각형까지의 거리의 최솟값 + 1로 정의해볼 수 있습니다. 좀 많이 기묘해보일 수 있지만, 점화식을 조금 더 잘 뜯어보겠습니다.</p>

<p>기저 조건으로 $j-i \equiv 1 \mod n$이면 $f(i, j)$는 $0$입니다. 또, 선분 $i-j$를 그을 수 없을 때는 $\infty$입니다. 그 외에는 이제 삼각형을 만들어줘야 하는데, 집합 $V$를 $i$와 $j$랑 이어 $P_{ij}$ 내부에 놓이는 삼각형이 존재할 때의 점들의 집합이라고 합시다. 그럼 삼각형 $t$가 $i-k-j$로 구성된다고 할 수 있습니다 (당연하게도 선분 교차 판정이 선행되어야 합니다).</p>

<ul>
  <li>$f(i, k) + f(k, j) &gt; d$라면, 삼각형 $t$를 이으면 지름이 $d$ 초과인 트리가 생기게 되므로 이 경우는 고려할 수 없습니다.</li>
  <li>그 외의 경우라면, $f(i, j)$를 $max(f(i, k), f(k, j)) + 1$로 갱신할 수 있습니다. 삼각형 $t$가 추가되므로 사전적인 $f$의 조건에 부합할 뿐더러, 두 값이 모두 $\infty$가 아니라면$f(i, k)$와 $f(k, j)$의 서브트리가 지름이 $d$ 이하이므로 합쳐도 이후의 $f$를 계산할 때 지장이 없습니다.</li>
</ul>

<p>가능한 $k$ 중 최솟값을 $f(i, j)$로 갱신하면 됩니다.</p>

<p>재귀적인 구조에 의해, $f(0, n-1)$이 $\infty$인 것과 지름 $d$ 이하의 삼각분할이 존재하지 않음이 동치입니다. 즉 위의 결정 문제를 $\mathcal{O}(n^3)$으로 해결할 수 있고, 결정문제로 바꾸었기 때문에 이분 탐색을 이용하여 $\mathcal{O}(n^3 \lg n)$에 해결할 수 있습니다.</p>

<p>코드는 다음과 같습니다. 자잘한 실수가 좀 많이 나서 서브태스크 1을 먼저 확인해 DP 로직이 맞는지 확인한 다음, 조금씩 실수를 고쳐나간 끝에 6번째 시도에서 만점을 받을 수 있었습니다.</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;bits/stdc++.h&gt;
</span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="k">using</span> <span class="n">ll</span> <span class="o">=</span> <span class="kt">long</span> <span class="kt">long</span><span class="p">;</span>
<span class="k">using</span> <span class="n">pii</span> <span class="o">=</span> <span class="n">pair</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">inf</span> <span class="o">=</span> <span class="mf">1e9</span><span class="p">;</span>
<span class="k">struct</span> <span class="nc">point</span> <span class="p">{</span>
    <span class="n">ll</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">;</span>
    <span class="n">point</span><span class="p">(</span><span class="n">ll</span> <span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ll</span> <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">:</span> <span class="n">x</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">y</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="p">{}</span>
    <span class="n">point</span> <span class="k">operator</span><span class="o">-</span> <span class="p">(</span><span class="n">point</span> <span class="n">a</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span><span class="k">return</span> <span class="n">point</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">a</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">-</span><span class="n">a</span><span class="p">.</span><span class="n">y</span><span class="p">);}</span>
    <span class="n">ll</span> <span class="k">operator</span><span class="o">/</span> <span class="p">(</span><span class="n">point</span> <span class="n">a</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span><span class="k">return</span> <span class="n">x</span><span class="o">*</span><span class="n">a</span><span class="p">.</span><span class="n">y</span><span class="o">-</span><span class="n">y</span><span class="o">*</span><span class="n">a</span><span class="p">.</span><span class="n">x</span><span class="p">;}</span>
<span class="p">};</span>
<span class="k">struct</span> <span class="nc">seg</span> <span class="p">{</span>
    <span class="n">point</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">;</span>
<span class="p">};</span>
<span class="kt">int</span> <span class="nf">sgn</span><span class="p">(</span><span class="n">ll</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span><span class="k">return</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">);}</span>
<span class="kt">bool</span> <span class="nf">seg_cross</span><span class="p">(</span><span class="n">seg</span> <span class="n">s1</span><span class="p">,</span> <span class="n">seg</span> <span class="n">s2</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">point</span> <span class="n">a</span> <span class="o">=</span> <span class="n">s1</span><span class="p">.</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">s1</span><span class="p">.</span><span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">s2</span><span class="p">.</span><span class="n">a</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="n">s2</span><span class="p">.</span><span class="n">b</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">oa</span> <span class="o">=</span> <span class="p">(</span><span class="n">d</span><span class="o">-</span><span class="n">c</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="n">c</span><span class="p">),</span> <span class="n">ob</span> <span class="o">=</span> <span class="p">(</span><span class="n">d</span><span class="o">-</span><span class="n">c</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">b</span><span class="o">-</span><span class="n">c</span><span class="p">),</span>
        <span class="n">oc</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span><span class="o">-</span><span class="n">a</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">c</span><span class="o">-</span><span class="n">a</span><span class="p">),</span> <span class="n">od</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span><span class="o">-</span><span class="n">a</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">d</span><span class="o">-</span><span class="n">a</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">oa</span><span class="o">*</span><span class="n">ob</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">oc</span><span class="o">*</span><span class="n">od</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">n</span><span class="p">;</span>
<span class="n">point</span> <span class="n">p</span><span class="p">[</span><span class="mi">303</span><span class="p">];</span>
<span class="n">seg</span> <span class="n">s</span><span class="p">[</span><span class="mi">303</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">dp</span><span class="p">[</span><span class="mi">303</span><span class="p">][</span><span class="mi">303</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">ok</span><span class="p">[</span><span class="mi">303</span><span class="p">][</span><span class="mi">303</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">tol</span><span class="p">;</span>
<span class="kt">int</span> <span class="nf">f</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">int</span><span class="o">&amp;</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">dp</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">y</span><span class="p">];</span>
    <span class="k">if</span><span class="p">(</span><span class="o">~</span><span class="n">ret</span><span class="p">)</span> <span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
    <span class="k">if</span><span class="p">((</span><span class="n">y</span><span class="o">-</span><span class="n">x</span><span class="o">+</span><span class="n">n</span><span class="p">)</span><span class="o">%</span><span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="k">return</span> <span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">ok</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">y</span><span class="p">])</span> <span class="k">return</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">inf</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">z</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">n</span><span class="p">;</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">inf</span><span class="p">;</span>
    <span class="k">while</span><span class="p">(</span><span class="n">z</span> <span class="o">!=</span> <span class="n">y</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">ok</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">z</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="n">ok</span><span class="p">[</span><span class="n">z</span><span class="p">][</span><span class="n">y</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="o">+</span> <span class="n">f</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">tol</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">ret</span><span class="p">,</span> <span class="n">max</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">),</span> <span class="n">f</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">z</span> <span class="o">=</span> <span class="p">(</span><span class="n">z</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">n</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="nf">right_dir</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">point</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">point</span> <span class="n">a1</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">b</span> <span class="o">-</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">a</span><span class="p">;</span>
    <span class="n">point</span> <span class="n">a2</span> <span class="o">=</span> <span class="n">s</span><span class="p">[(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="o">+</span><span class="n">n</span><span class="p">)</span><span class="o">%</span><span class="n">n</span><span class="p">].</span><span class="n">b</span> <span class="o">-</span> <span class="n">s</span><span class="p">[(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="o">+</span><span class="n">n</span><span class="p">)</span><span class="o">%</span><span class="n">n</span><span class="p">].</span><span class="n">a</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">a1</span> <span class="o">/</span> <span class="n">a2</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="n">a1</span> <span class="o">/</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">a2</span> <span class="o">/</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">else</span> <span class="k">return</span> <span class="n">a1</span> <span class="o">/</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">a2</span> <span class="o">/</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="nf">try_tol</span><span class="p">(</span><span class="kt">int</span> <span class="n">mid</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">tol</span> <span class="o">=</span> <span class="n">mid</span><span class="p">;</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">dp</span><span class="p">));</span>
    <span class="kt">int</span> <span class="n">res</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="o">+</span><span class="n">n</span><span class="p">)</span><span class="o">%</span><span class="n">n</span><span class="p">));</span>
    <span class="k">return</span> <span class="n">res</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="nf">print_answer</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">static</span> <span class="kt">int</span> <span class="n">tc</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Case #"</span> <span class="o">&lt;&lt;</span> <span class="o">++</span><span class="n">tc</span> <span class="o">&lt;&lt;</span> <span class="sc">'\n'</span> <span class="o">&lt;&lt;</span> <span class="n">x</span> <span class="o">&lt;&lt;</span> <span class="sc">'\n'</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">ios_base</span><span class="o">::</span><span class="n">sync_with_stdio</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
    <span class="n">cin</span><span class="p">.</span><span class="n">tie</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">tt</span><span class="p">;</span>
    <span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">tt</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">t</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">t</span><span class="o">&lt;=</span><span class="n">tt</span><span class="p">;</span><span class="n">t</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">memset</span><span class="p">(</span><span class="n">ok</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">ok</span><span class="p">));</span>
        <span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">n</span><span class="p">;</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">x</span> <span class="o">&gt;&gt;</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">y</span><span class="p">;</span>
            <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">a</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
            <span class="n">s</span><span class="p">[(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="o">+</span><span class="n">n</span><span class="p">)</span><span class="o">%</span><span class="n">n</span><span class="p">].</span><span class="n">b</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="p">}</span>
        <span class="k">if</span><span class="p">(</span><span class="n">n</span> <span class="o">&lt;=</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">print_answer</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">3</span><span class="p">);</span>
            <span class="k">continue</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">;</span><span class="n">j</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span><span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">seg</span> <span class="n">c</span> <span class="o">=</span> <span class="p">{</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="n">j</span><span class="p">]};</span>
                <span class="n">ok</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">right_dir</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">-</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="n">right_dir</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">p</span><span class="p">[</span><span class="n">j</span><span class="p">]);</span>
                <span class="k">if</span><span class="p">(</span><span class="n">ok</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span> <span class="p">{</span>
                    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">k</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">k</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span><span class="n">k</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">if</span><span class="p">(</span><span class="n">k</span> <span class="o">==</span> <span class="n">i</span> <span class="o">||</span> <span class="n">k</span> <span class="o">==</span> <span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="o">+</span><span class="n">n</span><span class="p">)</span><span class="o">%</span><span class="n">n</span> <span class="o">||</span>
                           <span class="n">k</span> <span class="o">==</span> <span class="n">j</span> <span class="o">||</span> <span class="n">k</span> <span class="o">==</span> <span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="o">+</span><span class="n">n</span><span class="p">)</span><span class="o">%</span><span class="n">n</span><span class="p">)</span> <span class="p">{</span>
                            <span class="k">continue</span><span class="p">;</span>
                        <span class="p">}</span>
                        <span class="k">if</span><span class="p">(</span><span class="n">seg_cross</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">s</span><span class="p">[</span><span class="n">k</span><span class="p">]))</span> <span class="n">ok</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
                <span class="n">ok</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">ok</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">];</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
            <span class="n">ok</span><span class="p">[</span><span class="n">i</span><span class="p">][(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">ok</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="n">n</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">lpos</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">rpos</span> <span class="o">=</span> <span class="n">n</span><span class="p">;</span>
        <span class="k">while</span><span class="p">(</span><span class="n">lpos</span> <span class="o">&lt;</span> <span class="n">rpos</span><span class="p">)</span> <span class="p">{</span>
            <span class="kt">int</span> <span class="n">mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">lpos</span> <span class="o">+</span> <span class="n">rpos</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
            <span class="k">if</span><span class="p">(</span><span class="n">try_tol</span><span class="p">(</span><span class="n">mid</span><span class="p">)</span> <span class="o">!=</span> <span class="n">inf</span><span class="p">)</span> <span class="n">rpos</span> <span class="o">=</span> <span class="n">mid</span><span class="p">;</span>
            <span class="k">else</span> <span class="n">lpos</span> <span class="o">=</span> <span class="n">mid</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">print_answer</span><span class="p">(</span><span class="n">lpos</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> 태그: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/tags/#ps" class="page__taxonomy-item" rel="tag">PS</a>
    
    </span>
  </p>




  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> 카테고리: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/categories/#algo" class="page__taxonomy-item" rel="tag">algo</a>
    
    </span>
  </p>


        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> 업데이트:</strong> <time datetime="2020-09-05">September 05, 2020</time></p>
        
      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">공유하기</h4>
  

  <a href="https://twitter.com/intent/tweet?text=SCPC+2020+Round+2+%ED%9B%84%EA%B8%B0%20%2Falgo%2Fscpc-2020-round-2%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="공유하기 Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=%2Falgo%2Fscpc-2020-round-2%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="공유하기 Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=%2Falgo%2Fscpc-2020-round-2%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="공유하기 LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/algo/scpc-2020-round-1/" class="pagination--pager" title="SCPC 2020 Round 1 후기
">이전</a>
    
    
      <a href="#" class="pagination--pager disabled">다음</a>
    
  </nav>

    </div>

    
  </article>

  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="검색어를 입력하세요..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>팔로우:</strong></li>
    

    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> 피드</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2020 ......!. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    <!--
  + https://github.com/mmistakes/minimal-mistakes/blob/master/_includes/scripts.html 
  + Revision 8444d54 on Jun 28, 2019 / Retrieve Dec 29, 2019
-->

  <script src="/assets/js/main.min.js"></script>
  <script src="https://kit.fontawesome.com/4eee35f757.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>






<!--
  + MathJax
  + credit : https://www.janmeppe.com/blog/How-to-add-mathjax-to-minimal-mistakes/
  + Retrived Dec 29, 2019
-->

<script type="text/javascript" async
	src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML">
</script>

<script type="text/x-mathjax-config">
   MathJax.Hub.Config({
     extensions: ["tex2jax.js"],
     jax: ["input/TeX", "output/HTML-CSS"],
     tex2jax: {
       inlineMath: [ ['$','$'], ["\\(","\\)"] ],
       displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
       processEscapes: true
     },
     "HTML-CSS": { availableFonts: ["TeX"] }
   });
</script>



  </body>
</html>
